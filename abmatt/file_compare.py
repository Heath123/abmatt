#!/usr/bin/python
import sys


def setup_ignored(ignored_offsets, start):
    ret = []
    for x in ignored_offsets:
        if x > start:
            x -= start
        ret.extend([x, x + 1, x + 2, x + 3])
    return ret


def main(argv):
    if not len(argv) > 1:
        print("Usage: file_compare.py file1 file2")
    print('Comparing "{}" and "{}"'.format(argv[0], argv[1]))
    start = argv[2:4] if len(argv) > 2 else (0, 0)
    max = argv[4] if len(argv) > 4 else 0x7FFFFFFF
    with open(argv[0], 'rb') as f1:
        f1_data = f1.read()
    with open(argv[1], 'rb') as f2:
        f2_data = f2.read()
    if start:
        f1_data = f1_data[start[0]:]
        f2_data = f2_data[start[1]:]
    ignore_offsets = setup_ignored(argv[5], start[0])
    if len(f1_data) != len(f2_data):
        print('Mismatched file lengths: {}, {}'.format(start[0] + len(f1_data), start[1] + len(f2_data)))
    m = min(len(f1_data), len(f2_data), max)
    for i in range(m):
        if f1_data[i] != f2_data[i] and i not in ignore_offsets:
            print('Mismatch at {}!\n{}\n{}'.format(i, f1_data[i:i + 5], f2_data[i:i + 5]))
    # if len(f1_data) > len(f2_data):
    #     print('Extra on {}: {}'.format(argv[0], f1_data[len(f2_data):]))
    # elif len(f2_data) > len(f1_data):
    #     print('Extra data on {}: {}'.format(argv[1], f2_data[len(f1_data):]))


if __name__ == "__main__":
    if len(sys.argv) > 2:
        file1 = sys.argv[0]
        file2 = sys.argv[1]
    else:
        file1 = '../brres_files/water_course.brres'
        file2 = '../brres_files/test.brres'
    compare_start0 = 0  # 2183680
    compare_start1 = 0  # 2183264
    compare_length = 10000
    ignore_offsets = [40, 112, 152, 848, 1156, 1228, 1268, 1740, 1876, 2204, 2788, 3260, 3732, 4204, 2837116, 2837344, 2837548, 2837780, 2837924, 2838428, 2838668, 56, 72, 88, 128, 864, 1064, 2837080, 168, 4828, 46872, 592596, 184, 4860, 46976, 600852, 200, 4796, 45324, 601044, 216, 4812, 45376, 605204, 232, 4396, 19128, 48576, 607316, 248, 4780, 45272, 611476, 264, 4876, 48472, 612052, 280, 4348, 14636, 37676, 40748, 48524, 617492, 296, 4844, 46924, 628308, 312, 4588, 31448, 629396, 328, 4604, 31500, 716500, 344, 4524, 25400, 759572, 360, 4540, 26904, 765012, 376, 4220, 6964, 781460, 392, 4556, 28408, 824532, 408, 3044, 3516, 4572, 28872, 29912, 840980, 424, 4620, 33048, 884564, 440, 3092, 3564, 4636, 33544, 34584, 928148, 456, 4236, 8472, 971220, 472, 4460, 20792, 987668, 488, 4476, 20844, 990420, 504, 4380, 17624, 993172, 520, 4684, 37624, 1036244, 536, 4428, 19232, 1057812, 552, 4444, 19284, 1079380, 568, 2836, 3308, 4268, 8968, 10008, 1100948, 584, 3140, 3612, 4700, 38120, 39160, 1188052, 600, 4300, 11544, 1275156, 616, 4716, 40696, 1318740, 632, 4284, 10060, 11596, 29964, 31552, 33100, 39212, 1361812, 648, 4668, 36140, 2410452, 664, 4252, 8524, 2541588, 680, 3172, 3644, 4732, 41192, 42232, 2542676, 696, 2868, 3340, 4316, 12040, 13080, 2629780, 712, 4652, 36088, 2715860, 728, 4492, 23864, 2737748, 744, 4508, 23916, 2746004, 760, 4332, 14584, 2754260, 776, 2900, 3372, 4364, 15080, 16120, 2759700, 792, 4748, 43736, 2770516, 808, 4764, 43788, 2814100, 824, 4412, 19180, 22328, 22380, 2815188, 880, 2837308, 896, 2837512, 912, 2837744, 928, 2837888, 944, 2838392, 960, 2838632, 1172, 1188, 1204, 1244, 5716, 1284, 1892, 295148, 519724, 1300, 309388, 1316, 1756, 1908, 329964, 504524, 520076, 1332, 1772, 1924, 356172, 512076, 521580, 1348, 356524, 1364, 1788, 1940, 365388, 512172, 521676, 1380, 1804, 370284, 514220, 1396, 374796, 1412, 1820, 381228, 514956, 1428, 1972, 382220, 522348, 1444, 1988, 383820, 522444, 1460, 391148, 1476, 400524, 1492, 420460, 1508, 2004, 421996, 523084, 1524, 422444, 1540, 2020, 424140, 523148, 1556, 1836, 2036, 428684, 515020, 523692, 1572, 1852, 450348, 519564, 1588, 2052, 450668, 523852, 1604, 2068, 458604, 523916, 1620, 2084, 460684, 524396, 1636, 2100, 464460, 525004, 1652, 2116, 468652, 525740, 1668, 2132, 479244, 527724, 1684, 2148, 485452, 528972, 1700, 2164, 490572, 529100, 1716, 2180, 504172, 530764, 1956, 521964, 2220, 530828, 2236, 535884, 2252, 537388, 2268, 541292, 2284, 541388, 2300, 543276, 2316, 545132, 2332, 546700, 2348, 549068, 2364, 549292, 2380, 549548, 2396, 550988, 2412, 553644, 2428, 560332, 2444, 560460, 2460, 560652, 2476, 561100, 2492, 561420, 2508, 561708, 2524, 561868, 2540, 562252, 2556, 562988, 2572, 564268, 2588, 565580, 2604, 567340, 2620, 568844, 2636, 572204, 2652, 575244, 2668, 577292, 2684, 579340, 2700, 581164, 2716, 582924, 2732, 587404, 2748, 592268, 2764, 592428, 2804, 3276, 5924, 2837796, 2837804, 2820, 3292, 7432, 2852, 3324, 10504, 2884, 3356, 13544, 2838684, 2838708, 2916, 3388, 16584, 2932, 3404, 18088, 2838444, 2838452, 2948, 3420, 19752, 2837940, 2838012, 2964, 3436, 21288, 2837956, 2838056, 2980, 3452, 22824, 2838700, 2838736, 2996, 3468, 24360, 3012, 3484, 25864, 2837972, 2838104, 3028, 3500, 27368, 3060, 3532, 30408, 3076, 3548, 32008, 3108, 3580, 35048, 3124, 3596, 36584, 2837988, 2838140, 3156, 3628, 39656, 2838004, 2838168, 3188, 3660, 42696, 3204, 3676, 44232, 2837132, 2837140, 3220, 3692, 45832, 2837360, 2837368, 3236, 3708, 47432, 2837564, 2837572, 3748, 57272, 3764, 70200, 3780, 88856, 3796, 130616, 3812, 131096, 3828, 138488, 3844, 146136, 3860, 150200, 3876, 156408, 3892, 157304, 3908, 158072, 3924, 165880, 3940, 173400, 3956, 188568, 3972, 189496, 3988, 190104, 4004, 191768, 4020, 196888, 4036, 230872, 4052, 231320, 4068, 236120, 4084, 237368, 4100, 241688, 4116, 246904, 4132, 261048, 4148, 269528, 4164, 275288, 4180, 294584, 44, 116, 132, 156, 172, 188, 204, 220, 236, 252, 268, 284, 300, 316, 332, 348, 364, 380, 396, 412, 428, 444, 460, 476, 492, 508, 524, 540, 556, 572, 588, 604, 620, 636, 652, 668, 684, 700, 716, 732, 748, 764, 780, 796, 812, 828, 852, 868, 884, 900, 916, 932, 948, 964, 1008, 1012, 1016, 1020, 1024, 1028, 1032, 1036, 1040, 1044, 1048, 1052, 1056, 1060, 1104, 1160, 1176, 1192, 1208, 1232, 1248, 1272, 1288, 1304, 1320, 1336, 1352, 1368, 1384, 1400, 1416, 1432, 1448, 1464, 1480, 1496, 1512, 1528, 1544, 1560, 1576, 1592, 1608, 1624, 1640, 1656, 1672, 1688, 1704, 1720, 1744, 1760, 1776, 1792, 1808, 1824, 1840, 1856, 1880, 1896, 1912, 1928, 1944, 1960, 1976, 1992, 2008, 2024, 2040, 2056, 2072, 2088, 2104, 2120, 2136, 2152, 2168, 2184, 2208, 2224, 2240, 2256, 2272, 2288, 2304, 2320, 2336, 2352, 2368, 2384, 2400, 2416, 2432, 2448, 2464, 2480, 2496, 2512, 2528, 2544, 2560, 2576, 2592, 2608, 2624, 2640, 2656, 2672, 2688, 2704, 2720, 2736, 2752, 2768, 2792, 2808, 2824, 2840, 2856, 2872, 2888, 2904, 2920, 2936, 2952, 2968, 2984, 3000, 3016, 3032, 3048, 3064, 3080, 3096, 3112, 3128, 3144, 3160, 3176, 3192, 3208, 3224, 3240, 3264, 3280, 3296, 3312, 3328, 3344, 3360, 3376, 3392, 3408, 3424, 3440, 3456, 3472, 3488, 3504, 3520, 3536, 3552, 3568, 3584, 3600, 3616, 3632, 3648, 3664, 3680, 3696, 3712, 3736, 3752, 3768, 3784, 3800, 3816, 3832, 3848, 3864, 3880, 3896, 3912, 3928, 3944, 3960, 3976, 3992, 4008, 4024, 4040, 4056, 4072, 4088, 4104, 4120, 4136, 4152, 4168, 4184, 4208, 4224, 4240, 4256, 4272, 4288, 4304, 4320, 4336, 4352, 4368, 4384, 4400, 4416, 4432, 4448, 4464, 4480, 4496, 4512, 4528, 4544, 4560, 4576, 4592, 4608, 4624, 4640, 4656, 4672, 4688, 4704, 4720, 4736, 4752, 4768, 4784, 4800, 4816, 4832, 4848, 4864, 4880, 4888, 4892, 4900, 4904, 4912, 4916, 4924, 4928, 4936, 4940, 4944, 4948, 4952, 4956, 4960, 4964, 4968, 4972, 4976, 4980, 4988, 4992, 5000, 5004, 5012, 5016, 5024, 5028, 5032, 5036, 5040, 5044, 5048, 5052, 5060, 5064, 5072, 5076, 5084, 5088, 5092, 5096, 5104, 5108, 5112, 5116, 5120, 5124, 5132, 5136, 5144, 5148, 5156, 5160, 5168, 5172, 5180, 5184, 5192, 5196, 5204, 5208, 5216, 5220, 5228, 5232, 5240, 5244, 5252, 5256, 5264, 5268, 5276, 5280, 5288, 5292, 5300, 5304, 5312, 5316, 5324, 5328, 5336, 5340, 5348, 5352, 5360, 5364, 5372, 5376, 5384, 5388, 5396, 5400, 5408, 5412, 5420, 5424, 5432, 5436, 5444, 5448, 5456, 5460, 5468, 5472, 5804, 5808, 5956, 5964, 5976, 7464, 7472, 7484, 9000, 9008, 9020, 10536, 10544, 10556, 12072, 12080, 12092, 13576, 13584, 13596, 15112, 15120, 15132, 16616, 16624, 16636, 18120, 18128, 18140, 19784, 19792, 19804, 21320, 21328, 21340, 22856, 22864, 22876, 24392, 24400, 24412, 25896, 25904, 25916, 27400, 27408, 27420, 28904, 28912, 28924, 30440, 30448, 30460, 32040, 32048, 32060, 33576, 33584, 33596, 35080, 35088, 35100, 36616, 36624, 36636, 38152, 38160, 38172, 39688, 39696, 39708, 41224, 41232, 41244, 42728, 42736, 42748, 44264, 44272, 44284, 45864, 45872, 45884, 47464, 47472, 47484, 57316, 70244, 88900, 130660, 131140, 138532, 146180, 150244, 156452, 157348, 158116, 165924, 173444, 188612, 189540, 190148, 191812, 196932, 230916, 231364, 236164, 237412, 241732, 246948, 261092, 269572, 275332, 294628, 295144, 309384, 329960, 356168, 356520, 365384, 370280, 374792, 381224, 382216, 383816, 391144, 400520, 420456, 421992, 422440, 424136, 428680, 450344, 450664, 458600, 460680, 464456, 468648, 479240, 485448, 490568, 504168, 504520, 512072, 512168, 514216, 514952, 515016, 519560, 519720, 520072, 521576, 521672, 521960, 522344, 522440, 523080, 523144, 523688, 523848, 523912, 524392, 525000, 525736, 527720, 528968, 529096, 530760, 530824, 535880, 537384, 541288, 541384, 543272, 545128, 546696, 549064, 549288, 549544, 550984, 553640, 560328, 560456, 560648, 561096, 561416, 561704, 561864, 562248, 562984, 564264, 565576, 567336, 568840, 572200, 575240, 577288, 579336, 581160, 582920, 587400, 592264, 592424, 592592, 600848, 601040, 605200, 607312, 611472, 612048, 617488, 628304, 629392, 716496, 759568, 765008, 781456, 824528, 840976, 884560, 928144, 971216, 987664, 990416, 993168, 1036240, 1057808, 1079376, 1100944, 1188048, 1275152, 1318736, 1361808, 2410448, 2541584, 2542672, 2629776, 2715856, 2737744, 2746000, 2754256, 2759696, 2770512, 2814096, 2815184, 2837072, 2837076, 2837120, 2837136, 2837152, 2837156, 2837160, 2837172, 2837196, 2837216, 2837300, 2837304, 2837348, 2837364, 2837380, 2837384, 2837400, 2837416, 2837420, 2837504, 2837508, 2837552, 2837568, 2837584, 2837588, 2837600, 2837604, 2837616, 2837620, 2837736, 2837740, 2837784, 2837800, 2837816, 2837824, 2837880, 2837884, 2837928, 2837944, 2837960, 2837976, 2837992, 2838008, 2838024, 2838028, 2838036, 2838048, 2838068, 2838072, 2838080, 2838084, 2838096, 2838100, 2838116, 2838132, 2838152, 2838160, 2838164, 2838180, 2838188, 2838384, 2838388, 2838432, 2838448, 2838464, 2838468, 2838472, 2838480, 2838484, 2838496, 2838508, 2838624, 2838628, 2838672, 2838688, 2838704, 2838720, 2838732, 2838748, 2838752, 2838764, 2838776]
    main((file1, file2, compare_start0, compare_start1, compare_length, ignore_offsets))
