#!/usr/bin/python
import math
import sys

def setup_ignored(ignored_offsets, start):
    ret = []
    for x in ignored_offsets:
        if x > start:
            x = x - start
            ret.extend([x, x + 1, x + 2, x + 3])
    return ret

def main(argv):
    if not len(argv) > 1:
        print("Usage: file_compare.py file1 file2")
    print('Comparing "{}" and "{}"'.format(argv[0], argv[1]))
    start = argv[2] if len(argv) > 2 else 0
    max = argv[3] if len(argv) > 3 else 0x7FFFFFFF
    with open(argv[0], 'rb') as f1:
        f1_data = f1.read()
    with open(argv[1], 'rb') as f2:
        f2_data = f2.read()
    if start:
        f1_data = f1_data[start:]
        f2_data = f2_data[start:]
    ignore_offsets = setup_ignored(argv[4], start)
    if len(f1_data) != len(f2_data):
        print('Mismatched file lengths: {}, {}'.format(start + len(f1_data), start + len(f2_data)))
    m = min(len(f1_data) - start, len(f2_data) - start, max)
    for i in range(m):
        if f1_data[i] != f2_data[i] and i not in ignore_offsets:
            print('Mismatch at {}!\n{}\n{}'.format(start + i, f1_data[i:i + 5], f2_data[i:i + 5]))
    # if len(f1_data) > len(f2_data):
    #     print('Extra on {}: {}'.format(argv[0], f1_data[len(f2_data):]))
    # elif len(f2_data) > len(f1_data):
    #     print('Extra data on {}: {}'.format(argv[1], f2_data[len(f1_data):]))


if __name__ == "__main__":
    if len(sys.argv) > 2:
        file1 = sys.argv[0]
        file2 = sys.argv[1]
    else:
        file1 = 'course_model.brres'
        file2 = 'test.brres'
    compare_start = 0
    compare_length = 1000
    ignore_offsets = [40, 128, 168, 656, 696, 900, 972, 1012, 1388, 1460, 1820, 2292, 2668, 3044, 3420, 56, 72, 88, 104, 144, 672, 712, 808, 2183720, 2183880, 184, 3452, 11768, 456276, 200, 3468, 17880, 477844, 216, 3484, 7212, 8748, 10284, 11820, 13356, 14892, 486100, 232, 3500, 33100, 1010452, 248, 3516, 28556, 1011540, 264, 3532, 22444, 1012628, 280, 3548, 22496, 1016788, 296, 3564, 22392, 1018900, 312, 3580, 23992, 1019476, 328, 3596, 27000, 1085076, 344, 3628, 25496, 1087188, 360, 3644, 20888, 1130260, 376, 3660, 10232, 1216340, 392, 3612, 5664, 1232788, 408, 3676, 16376, 1265620, 424, 1273876, 440, 1282132, 456, 3692, 28504, 1290388, 472, 3708, 30040, 1311956, 488, 3724, 31544, 1398036, 504, 3740, 34584, 1400788, 520, 3756, 36088, 1486868, 536, 3772, 33048, 1658964, 552, 3788, 7160, 1663124, 568, 3436, 8696, 1749204, 584, 3804, 13304, 1792276, 600, 3820, 19384, 1964372, 616, 3836, 14840, 2136468, 632, 3852, 37592, 2179540, 728, 2184108, 916, 932, 948, 988, 4416, 1028, 1404, 1476, 209612, 413612, 417292, 1044, 1492, 210764, 417804, 1060, 1508, 223436, 418220, 1076, 1524, 228620, 418636, 1092, 1540, 232812, 419020, 1108, 1556, 241196, 419340, 1124, 243980, 1140, 1572, 267212, 419532, 1156, 1588, 275372, 420044, 1172, 1604, 290604, 420108, 1188, 1620, 300620, 420844, 1204, 1636, 310284, 421004, 1220, 1652, 320524, 421324, 1236, 1668, 323052, 421868, 1252, 1420, 1684, 325004, 413868, 422028, 1268, 1700, 336684, 422156, 1284, 1716, 337804, 422220, 1300, 1732, 375340, 422572, 1316, 1436, 1748, 404812, 416972, 422636, 1332, 1764, 405772, 422732, 1348, 1780, 406508, 422796, 1364, 1796, 406700, 422860, 1836, 423116, 1852, 423244, 1868, 425996, 1884, 429612, 1900, 431404, 1916, 432940, 1932, 434444, 1948, 435884, 1964, 437420, 1980, 438412, 1996, 439404, 2012, 442220, 2028, 445228, 2044, 447916, 2060, 448140, 2076, 448812, 2092, 449740, 2108, 450188, 2124, 451244, 2140, 451852, 2156, 452588, 2172, 454316, 2188, 454572, 2204, 454764, 2220, 455148, 2236, 455596, 2252, 455692, 2268, 455852, 2308, 2684, 4624, 2324, 2700, 6120, 2340, 2716, 7656, 2356, 2732, 9192, 2372, 2748, 10728, 2388, 2764, 12264, 2404, 2780, 13800, 2420, 2796, 15336, 2436, 2812, 16840, 2452, 2828, 18344, 2468, 2844, 19848, 2484, 2860, 21352, 2500, 2876, 22952, 2516, 2892, 24456, 2532, 2908, 25960, 2548, 2924, 27464, 2564, 2940, 29000, 2580, 2956, 30504, 2596, 2972, 32008, 2612, 2988, 33544, 2628, 3004, 35048, 2644, 3020, 36552, 3060, 40660, 3076, 41428, 3092, 56980, 3108, 63028, 3124, 67796, 3140, 74996, 3156, 77300, 3172, 98452, 3188, 108564, 3204, 114932, 3220, 123284, 3236, 129780, 3252, 136340, 3268, 138868, 3284, 139732, 3300, 156180, 3316, 156884, 3332, 173492, 3348, 201396, 3364, 202676, 3380, 203316, 3396, 203796]
    main((file1, file2, compare_start, compare_length, ignore_offsets))
