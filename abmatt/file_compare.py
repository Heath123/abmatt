#!/usr/bin/python
import math
import sys

def setup_ignored(ignored_offsets, start):
    ret = []
    for x in ignored_offsets:
        if x > start:
            x = x - start
            ret.extend([x, x + 1, x + 2, x + 3])
    return ret

def main(argv):
    if not len(argv) > 1:
        print("Usage: file_compare.py file1 file2")
    print('Comparing "{}" and "{}"'.format(argv[0], argv[1]))
    start = argv[2] if len(argv) > 2 else 0
    max = argv[3] if len(argv) > 3 else 0x7FFFFFFF
    with open(argv[0], 'rb') as f1:
        f1_data = f1.read()
    with open(argv[1], 'rb') as f2:
        f2_data = f2.read()
    if start:
        f1_data = f1_data[start:]
        f2_data = f2_data[start:]
    ignore_offsets = setup_ignored(argv[4], start)
    if len(f1_data) != len(f2_data):
        print('Mismatched file lengths: {}, {}'.format(start + len(f1_data), start + len(f2_data)))
    m = min(len(f1_data) - start, len(f2_data) - start, max)
    for i in range(m):
        if f1_data[i] != f2_data[i] and i not in ignore_offsets:
            print('Mismatch at {}!\n{}\n{}'.format(start + i, f1_data[i:i + 5], f2_data[i:i + 5]))
    # if len(f1_data) > len(f2_data):
    #     print('Extra on {}: {}'.format(argv[0], f1_data[len(f2_data):]))
    # elif len(f2_data) > len(f1_data):
    #     print('Extra data on {}: {}'.format(argv[1], f2_data[len(f1_data):]))


if __name__ == "__main__":
    if len(sys.argv) > 2:
        file1 = sys.argv[0]
        file2 = sys.argv[1]
    else:
        file1 = 'fresh.brres'
        file2 = 'course_model.brres'
    compare_start = 0
    compare_length = 10000000
    ignore_offsets = [40, 112, 152, 1168, 1412, 1484, 1524, 2460, 3396, 4332, 5268, 6204, 7140, 4276700, 4276932, 4277160, 56, 72, 88, 128, 1184, 1320, 4276664, 168, 4364, 5300, 7156, 11080, 12120, 1262772, 184, 4380, 5316, 7300, 10612, 12584, 13624, 1273748, 200, 4396, 5332, 7460, 14088, 15128, 1317460, 216, 4428, 5364, 7588, 17192, 18232, 1361172, 232, 4444, 5380, 7700, 18696, 19736, 1383060, 248, 4460, 5396, 7796, 20200, 21240, 1426772, 264, 4476, 5412, 7812, 21704, 22744, 1470484, 280, 4492, 5428, 7828, 23208, 24248, 1492372, 296, 4508, 5444, 7844, 24712, 25752, 1514260, 312, 4524, 5460, 7172, 26216, 27256, 1557972, 328, 4540, 5476, 7188, 27720, 28760, 1568948, 344, 4556, 5492, 7204, 29224, 30264, 1656308, 360, 4572, 5508, 7220, 30728, 31768, 1678196, 376, 4588, 5524, 7236, 32232, 33272, 1700084, 392, 4604, 5540, 7252, 33736, 34776, 1743796, 408, 4620, 5556, 7268, 35240, 36280, 1765684, 424, 4652, 5588, 7284, 38280, 39320, 1787572, 440, 4668, 5604, 7316, 39784, 40824, 1798548, 456, 4684, 5620, 7332, 41288, 42328, 1973204, 472, 4700, 5636, 7348, 42792, 43832, 2060564, 488, 4716, 5652, 7364, 44296, 45336, 2235220, 504, 4732, 5668, 7380, 45800, 46840, 2257108, 520, 4748, 5684, 7396, 47304, 48344, 2257844, 536, 4764, 5700, 7412, 48808, 49848, 2301556, 552, 4780, 5716, 7428, 50312, 51352, 2302292, 568, 4796, 5732, 7444, 51816, 52856, 2307732, 584, 4812, 5748, 7476, 53320, 54360, 2395092, 600, 4828, 5764, 7492, 54824, 55864, 2438804, 616, 4844, 5780, 7508, 56328, 57368, 2482516, 632, 4860, 5796, 7524, 57832, 58872, 2504404, 648, 4876, 5812, 7540, 59336, 60376, 2526292, 664, 4892, 5828, 7556, 60840, 61880, 2548180, 680, 4908, 5844, 7572, 62344, 63384, 2550964, 696, 4924, 5860, 7604, 63848, 64888, 2594676, 712, 4940, 5876, 7620, 65352, 66392, 2616564, 728, 4956, 5892, 7636, 66856, 67896, 2619348, 744, 4972, 5908, 7652, 68360, 69400, 2663060, 760, 4988, 5924, 7668, 69864, 70904, 2665844, 776, 5004, 5940, 7684, 71368, 72408, 2687732, 792, 5020, 5956, 7716, 72872, 73912, 2775092, 808, 5036, 5972, 7732, 74376, 75416, 2818804, 824, 5052, 5988, 7748, 75880, 76920, 2906164, 840, 5084, 6020, 7764, 78984, 80024, 2949876, 856, 5100, 6036, 7780, 80488, 81528, 3037236, 872, 5116, 6052, 7860, 81992, 83032, 3080948, 888, 5132, 6068, 7876, 83496, 84536, 3255604, 904, 5180, 6116, 7892, 88008, 89048, 3430260, 920, 5196, 6132, 7908, 89512, 90552, 3779508, 936, 5228, 6164, 7956, 92520, 93560, 3801396, 952, 5212, 6148, 7988, 91016, 92056, 3801492, 968, 5164, 6100, 7972, 86504, 87544, 3976148, 984, 5244, 6180, 8004, 94024, 95064, 4150804, 1000, 5148, 6084, 8020, 85000, 86040, 4161780, 1016, 8084, 16684, 4167284, 1032, 8100, 16736, 4171444, 1048, 8068, 78528, 4173556, 1064, 7924, 16632, 4177716, 1080, 7940, 78424, 4178292, 1096, 8052, 78476, 4183732, 1112, 4636, 5572, 36744, 4194548, 4277176, 4277184, 1128, 8116, 37784, 4260148, 1144, 8132, 37836, 4268404, 1200, 4276896, 1216, 4277124, 1428, 1444, 1460, 1500, 9364, 1540, 2476, 545740, 829036, 1556, 2492, 548140, 829452, 1572, 2508, 590604, 880876, 1588, 2524, 599276, 890092, 1604, 2540, 604812, 890476, 1620, 2556, 605292, 890636, 1636, 2572, 608716, 890924, 1652, 2588, 615980, 894636, 1668, 2604, 624108, 896652, 1684, 2620, 635692, 898412, 1700, 2636, 648812, 900172, 1716, 2652, 652716, 900460, 1732, 2668, 660620, 909228, 1748, 2684, 678828, 921580, 1764, 2700, 685900, 924972, 1780, 2716, 687308, 925324, 1796, 2732, 687884, 925740, 1812, 2748, 688620, 925836, 1828, 2764, 690316, 926124, 1844, 2780, 690700, 926316, 1860, 2796, 694060, 926412, 1876, 2812, 722412, 934668, 1892, 2828, 737356, 939180, 1908, 2844, 740748, 944428, 1924, 2860, 741100, 944684, 1940, 2876, 745260, 949548, 1956, 2892, 753196, 954348, 1972, 2908, 755404, 957676, 1988, 2924, 755884, 957964, 2004, 2940, 768460, 964300, 2020, 2956, 778092, 968940, 2036, 2972, 778764, 969996, 2052, 2988, 779212, 970124, 2068, 3004, 780716, 970700, 2084, 3020, 785356, 976716, 2100, 3036, 802380, 1015692, 2116, 3052, 808300, 1025420, 2132, 3068, 808716, 1025644, 2148, 3084, 809324, 1025708, 2164, 3100, 809804, 1025804, 2180, 3116, 810252, 1025868, 2196, 3132, 811180, 1025996, 2212, 3148, 812812, 1026092, 2228, 3164, 813356, 1026700, 2244, 3180, 813612, 1026764, 2260, 3196, 813836, 1026924, 2276, 3212, 815148, 1026988, 2292, 3228, 815276, 1027052, 2308, 3244, 815692, 1027500, 2324, 3260, 816684, 1027660, 2340, 3276, 817612, 1027852, 2356, 3292, 817836, 1027916, 2372, 3308, 818636, 1028012, 2388, 3324, 819884, 1028204, 2404, 3340, 820108, 1028300, 2420, 3356, 821484, 1029388, 2436, 3372, 825388, 1029484, 3412, 1033484, 3428, 1035180, 3444, 1038380, 3460, 1049452, 3476, 1054316, 3492, 1054444, 3508, 1057068, 3524, 1061804, 3540, 1071372, 3556, 1080492, 3572, 1096012, 3588, 1098924, 3604, 1108684, 3620, 1122764, 3636, 1131500, 3652, 1132236, 3668, 1132716, 3684, 1133004, 3700, 1134828, 3716, 1134988, 3732, 1138348, 3748, 1166188, 3764, 1184940, 3780, 1186380, 3796, 1186508, 3812, 1190220, 3828, 1192748, 3844, 1193772, 3860, 1194028, 3876, 1207436, 3892, 1213420, 3908, 1213708, 3924, 1213900, 3940, 1214636, 3956, 1224012, 3972, 1238380, 3988, 1242828, 4004, 1243084, 4020, 1243340, 4036, 1243500, 4052, 1243628, 4068, 1244012, 4084, 1244716, 4100, 1245004, 4116, 1245164, 4132, 1245356, 4148, 1246284, 4164, 1246380, 4180, 1246924, 4196, 1248108, 4212, 1249004, 4228, 1249196, 4244, 1249932, 4260, 1250796, 4276, 1250988, 4292, 1253068, 4308, 1254988, 4348, 5284, 9572, 4412, 5348, 15592, 4276948, 4276956, 5068, 6004, 77384, 4276716, 4276724, 6220, 97624, 6236, 98840, 6252, 167640, 6268, 183160, 6284, 189560, 6300, 190072, 6316, 193624, 6332, 207000, 6348, 218456, 6364, 236504, 6380, 252856, 6396, 256568, 6412, 269784, 6428, 297944, 6444, 309496, 6460, 310744, 6476, 311576, 6492, 312280, 6508, 313688, 6524, 314232, 6540, 317752, 6556, 365496, 6572, 392920, 6588, 398904, 6604, 399480, 6620, 407288, 6636, 418872, 6652, 422424, 6668, 423000, 6684, 443384, 6700, 456504, 6716, 457304, 6732, 457848, 6748, 459192, 6764, 470136, 6780, 510424, 6796, 520120, 6812, 520728, 6828, 521336, 6844, 521880, 6860, 522360, 6876, 523128, 6892, 524440, 6908, 525080, 6924, 525528, 6940, 525976, 6956, 526904, 6972, 527288, 6988, 527864, 7004, 528824, 7020, 529624, 7036, 530040, 7052, 530776, 7068, 532216, 7084, 532664, 7100, 534264, 7116, 538968, 8036]
    main((file1, file2, compare_start, compare_length, ignore_offsets))
