#!/usr/bin/python
import math
import sys

def setup_ignored(ignored_offsets, start):
    ret = []
    for x in ignored_offsets:
        if x > start:
            x -= start
            ret.extend([x, x + 1, x + 2, x + 3])
    return ret

def main(argv):
    if not len(argv) > 1:
        print("Usage: file_compare.py file1 file2")
    print('Comparing "{}" and "{}"'.format(argv[0], argv[1]))
    start = argv[2] if len(argv) > 2 else 0
    max = argv[3] if len(argv) > 3 else 0x7FFFFFFF
    with open(argv[0], 'rb') as f1:
        f1_data = f1.read()
    with open(argv[1], 'rb') as f2:
        f2_data = f2.read()
    if start:
        f1_data = f1_data[start:]
        f2_data = f2_data[start:]
    ignore_offsets = setup_ignored(argv[4], start)
    if len(f1_data) != len(f2_data):
        print('Mismatched file lengths: {}, {}'.format(start + len(f1_data), start + len(f2_data)))
    m = min(len(f1_data), len(f2_data), max)
    for i in range(m):
        if f1_data[i] != f2_data[i] and i not in ignore_offsets:
            print('Mismatch at {}!\n{}\n{}'.format(start + i, f1_data[i:i + 5], f2_data[i:i + 5]))
    # if len(f1_data) > len(f2_data):
    #     print('Extra on {}: {}'.format(argv[0], f1_data[len(f2_data):]))
    # elif len(f2_data) > len(f1_data):
    #     print('Extra data on {}: {}'.format(argv[1], f2_data[len(f1_data):]))


if __name__ == "__main__":
    if len(sys.argv) > 2:
        file1 = sys.argv[0]
        file2 = sys.argv[1]
    else:
        file1 = 'anim_working.brres'
        file2 = 'test2.brres'
    compare_start = 4210982
    compare_length = 646
    ignore_offsets = [40, 112, 152, 1152, 1380, 1452, 1492, 2428, 3364, 4300, 5236, 6172, 7108, 4211036, 4211268, 4211496, 56, 72, 88, 128, 1168, 1288, 4211000, 168, 4332, 5268, 7140, 11016, 12056, 1262708, 184, 4348, 5284, 7124, 10552, 12520, 13560, 1273684, 200, 4364, 5300, 7156, 14024, 15064, 1317396, 216, 4396, 5332, 7220, 17128, 18168, 1361108, 232, 4412, 5348, 7236, 18632, 19672, 1382996, 248, 4428, 5364, 7252, 20136, 21176, 1426708, 264, 4444, 5380, 7268, 21640, 22680, 1470420, 280, 4460, 5396, 7284, 23144, 24184, 1492308, 296, 4476, 5412, 7300, 24648, 25688, 1514196, 312, 4492, 5428, 7316, 26152, 27192, 1557908, 328, 4508, 5444, 7332, 27656, 28696, 1568884, 344, 4524, 5460, 7348, 29160, 30200, 1656244, 360, 4540, 5476, 7364, 30664, 31704, 1678132, 376, 4556, 5492, 7380, 32168, 33208, 1700020, 392, 4572, 5508, 7396, 33672, 34712, 1743732, 408, 4588, 5524, 7412, 35176, 36216, 1765620, 424, 4620, 5556, 7460, 38216, 39256, 1787508, 440, 4636, 5572, 7476, 39720, 40760, 1798484, 456, 4652, 5588, 7492, 41224, 42264, 1973140, 472, 4668, 5604, 7508, 42728, 43768, 2060500, 488, 4684, 5620, 7524, 44232, 45272, 2235156, 504, 4700, 5636, 7540, 45736, 46776, 2257044, 520, 4716, 5652, 7556, 47240, 48280, 2257780, 536, 4732, 5668, 7572, 48744, 49784, 2301492, 552, 4748, 5684, 7588, 50248, 51288, 2302228, 568, 4764, 5700, 7604, 51752, 52792, 2307668, 584, 4780, 5716, 7620, 53256, 54296, 2395028, 600, 4796, 5732, 7636, 54760, 55800, 2438740, 616, 4812, 5748, 7652, 56264, 57304, 2482452, 632, 4828, 5764, 7668, 57768, 58808, 2504340, 648, 4844, 5780, 7684, 59272, 60312, 2526228, 664, 4860, 5796, 7700, 60776, 61816, 2548116, 680, 4876, 5812, 7716, 62280, 63320, 2550900, 696, 4892, 5828, 7732, 63784, 64824, 2594612, 712, 4908, 5844, 7748, 65288, 66328, 2616500, 728, 4924, 5860, 7764, 66792, 67832, 2619284, 744, 4940, 5876, 7780, 68296, 69336, 2662996, 760, 4956, 5892, 7796, 69800, 70840, 2665780, 776, 4972, 5908, 7812, 71304, 72344, 2687668, 792, 4988, 5924, 7828, 72808, 73848, 2775028, 808, 5004, 5940, 7844, 74312, 75352, 2818740, 824, 5020, 5956, 7860, 75816, 76856, 2906100, 840, 5052, 5988, 7924, 78920, 79960, 2949812, 856, 5068, 6004, 7940, 80424, 81464, 3037172, 872, 5084, 6020, 7956, 81928, 82968, 3080884, 888, 5100, 6036, 7972, 83432, 84472, 3255540, 904, 5148, 6084, 8020, 87944, 88984, 3430196, 920, 5164, 6100, 8036, 89448, 90488, 3779444, 936, 5196, 6132, 8068, 92456, 93496, 3801332, 952, 5180, 6116, 8052, 90952, 91992, 3801428, 968, 5132, 6068, 8004, 86440, 87480, 3976084, 984, 5212, 6148, 8084, 93960, 95000, 4150740, 1000, 5116, 6052, 7988, 84936, 85976, 4161716, 1016, 7188, 16620, 4167220, 1032, 7204, 16672, 4171380, 1048, 7908, 78464, 4173492, 1064, 7172, 16568, 4177652, 1080, 7876, 78360, 4178228, 1096, 7892, 78412, 4183668, 1112, 7428, 37720, 4194484, 1128, 7444, 37772, 4202740, 1184, 4211232, 1200, 4211460, 1396, 1412, 1428, 1468, 9304, 1508, 2444, 545676, 828972, 1524, 2460, 548076, 829388, 1540, 2476, 590540, 880812, 1556, 2492, 599212, 890028, 1572, 2508, 604748, 890412, 1588, 2524, 605228, 890572, 1604, 2540, 608652, 890860, 1620, 2556, 615916, 894572, 1636, 2572, 624044, 896588, 1652, 2588, 635628, 898348, 1668, 2604, 648748, 900108, 1684, 2620, 652652, 900396, 1700, 2636, 660556, 909164, 1716, 2652, 678764, 921516, 1732, 2668, 685836, 924908, 1748, 2684, 687244, 925260, 1764, 2700, 687820, 925676, 1780, 2716, 688556, 925772, 1796, 2732, 690252, 926060, 1812, 2748, 690636, 926252, 1828, 2764, 693996, 926348, 1844, 2780, 722348, 934604, 1860, 2796, 737292, 939116, 1876, 2812, 740684, 944364, 1892, 2828, 741036, 944620, 1908, 2844, 745196, 949484, 1924, 2860, 753132, 954284, 1940, 2876, 755340, 957612, 1956, 2892, 755820, 957900, 1972, 2908, 768396, 964236, 1988, 2924, 778028, 968876, 2004, 2940, 778700, 969932, 2020, 2956, 779148, 970060, 2036, 2972, 780652, 970636, 2052, 2988, 785292, 976652, 2068, 3004, 802316, 1015628, 2084, 3020, 808236, 1025356, 2100, 3036, 808652, 1025580, 2116, 3052, 809260, 1025644, 2132, 3068, 809740, 1025740, 2148, 3084, 810188, 1025804, 2164, 3100, 811116, 1025932, 2180, 3116, 812748, 1026028, 2196, 3132, 813292, 1026636, 2212, 3148, 813548, 1026700, 2228, 3164, 813772, 1026860, 2244, 3180, 815084, 1026924, 2260, 3196, 815212, 1026988, 2276, 3212, 815628, 1027436, 2292, 3228, 816620, 1027596, 2308, 3244, 817548, 1027788, 2324, 3260, 817772, 1027852, 2340, 3276, 818572, 1027948, 2356, 3292, 819820, 1028140, 2372, 3308, 820044, 1028236, 2388, 3324, 821420, 1029324, 2404, 3340, 825324, 1029420, 3380, 1033420, 3396, 1035116, 3412, 1038316, 3428, 1049388, 3444, 1054252, 3460, 1054380, 3476, 1057004, 3492, 1061740, 3508, 1071308, 3524, 1080428, 3540, 1095948, 3556, 1098860, 3572, 1108620, 3588, 1122700, 3604, 1131436, 3620, 1132172, 3636, 1132652, 3652, 1132940, 3668, 1134764, 3684, 1134924, 3700, 1138284, 3716, 1166124, 3732, 1184876, 3748, 1186316, 3764, 1186444, 3780, 1190156, 3796, 1192684, 3812, 1193708, 3828, 1193964, 3844, 1207372, 3860, 1213356, 3876, 1213644, 3892, 1213836, 3908, 1214572, 3924, 1223948, 3940, 1238316, 3956, 1242764, 3972, 1243020, 3988, 1243276, 4004, 1243436, 4020, 1243564, 4036, 1243948, 4052, 1244652, 4068, 1244940, 4084, 1245100, 4100, 1245292, 4116, 1246220, 4132, 1246316, 4148, 1246860, 4164, 1248044, 4180, 1248940, 4196, 1249132, 4212, 1249868, 4228, 1250732, 4244, 1250924, 4260, 1253004, 4276, 1254924, 4316, 5252, 9512, 4380, 5316, 15528, 4211284, 4211292, 4604, 5540, 36680, 4211512, 4211520, 5036, 5972, 77320, 4211052, 4211060, 6188, 97560, 6204, 98776, 6220, 167576, 6236, 183096, 6252, 189496, 6268, 190008, 6284, 193560, 6300, 206936, 6316, 218392, 6332, 236440, 6348, 252792, 6364, 256504, 6380, 269720, 6396, 297880, 6412, 309432, 6428, 310680, 6444, 311512, 6460, 312216, 6476, 313624, 6492, 314168, 6508, 317688, 6524, 365432, 6540, 392856, 6556, 398840, 6572, 399416, 6588, 407224, 6604, 418808, 6620, 422360, 6636, 422936, 6652, 443320, 6668, 456440, 6684, 457240, 6700, 457784, 6716, 459128, 6732, 470072, 6748, 510360, 6764, 520056, 6780, 520664, 6796, 521272, 6812, 521816, 6828, 522296, 6844, 523064, 6860, 524376, 6876, 525016, 6892, 525464, 6908, 525912, 6924, 526840, 6940, 527224, 6956, 527800, 6972, 528760, 6988, 529560, 7004, 529976, 7020, 530712, 7036, 532152, 7052, 532600, 7068, 534200, 7084, 538904]
    main((file1, file2, compare_start, compare_length, ignore_offsets))
